var model = "eyJNTExRTExRTExRTExMUUxMUUxMUVpNTExRTExRTExRTExRTExRTExRTExRWk1MTFFMTExRTExRTExRTExRTExRTExRTExRTExRTExRTExRTExRTExRWk1MTFFMTExRTExRTExRTExRTExRTExRTExRTExRTExRTExRTExRTExRTExRWk1MTFFMTExRTExRWk1MTFFMTFFMTFFMTFFaIjogIjAiLCAiTUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUVpNTExRTExRTExRTExRTExRTExRTExRTExRTExRTExRTExRTExRTFoiOiAiMSIsICJNTExRTExRTExRTExRTExRTExRTExRTExRTExRTExRTExRTExRTExRTExRTExRTExMUUxMUUxMUUxMUUxMUUxMUUxMUVpNTExRTExMUUxMUUxMUUxMUUxMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTExRTExRTExRTExRTExRTExMUUxMTFFMTFFaIjogIjIiLCAiTUxMUUxMUUxMUUxMUUxMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTExRTExRTExRTExRTExRTExRTExRTExRTExRTExRTExRTExRTExRTExRTExRTExRTExRTExRTExRTExRTExRWk1MTFFMTFFMTFFMTFFMTFFMTExMUUxMUUxMUUxMUUxMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTExMUUxMUUxMUUxMUUxMUUxMUUxMTExRTExRTExRTExRTExRTExRTExMTExMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUVoiOiAiMyIsICJNTExRTExRTExRTExRWk1MTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTExRTExRTExRTExRWk1MTFFMTExRTExRTExRTExRTExRTExRTExMUUxMTFFMTExRTExRTExRTExRTExRTExRTExRTExMUUxMUUxMUUxMUVpNTExRTExRTExRTExRTExRWiI6ICI0IiwgIk1MTFFMTFFMTFFMTFFMTFFMTFFMTFFMTExMUUxMUUxMUUxMUUxMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFaTUxMUUxMUUxMUUxMUUxMTExMUUxMTFFMTExRTExRTExRTExMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMTExRTExRTExRTExRTExRWiI6ICI1IiwgIk1MTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFaTUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUVpNTExRTExRTExRTExRTExRTExRTExRTExMTFFMTFFMTFFMTExRTExRTExRTExRTExRTExRTExRTExRTExRTExRTExRWk1MTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFaIjogIjYiLCAiTUxMUUxMUUxMTFFMTFFMTFFMTFFMTFFMTExRTExRTExMUUxMUUxMUUxMTFFMTFFMTFFMTFFMTFFaTUxMTFFMTExRTExRTExRTExRTExRTExRTExRTExRTExRTExRTExRTExMTExRTExRTExRTExRTExRTExMUUxMTFFMTFFMTFFMTExRWiI6ICI3IiwgIk1MTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFaTUxMUUxMUUxMUUxMUUxMUUxMUUxMUVpNTExMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUVpNTExMUUxMUUxMUUxMUUxMTExMUUxMUUxMUUxMUUxMTExRTExMUUxMUUxMUUxMUUxMUUxMUUxMUUxMTFFMTFFMTFFMTFFMTFFaTUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUVpNTExRTExMUUxMUUxMUUxMUUxMUUxMUVoiOiAiOCIsICJNTExMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUVpNTExMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUVpNTExRTExRTExRTExMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMTFFMTFFMTFFMTFFMTExRWk1MTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFaIjogIjkiLCAiTUxMUUxMUUxMUUxMUUxMUVpNTExRTExRTExRTExRTExRTExRTExRTExMUUxMUUxMUUxMUVpNTExMUUxMUUxMUUxMUUxMUUxMTFFMTExRTExRTExRTExRTExRTExRTExRTExRTExRTExRTExRTExRWk1MTFFMTExRWiI6ICJBIiwgIk1MTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFaTUxMUUxMUUxMUUxMUUxMUUxMUVpNTExRTExRTExRTExRTExRTExRTExRTExRTExRTExRTExRTExRWk1MTFFMTFFMTFFMTFFMTFFMTExRTExRTExRTExRTExRTExRTExRTExRTExRTExMUUxMUUxMUVpNTExRTExRTExRTExRTExMUUxMUUxMUUxMUVpNTExMUUxMTExMUUxMTFFMTFFMTFFMTFFMTFFMTFFaIjogIkIiLCAiTUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUVpNTExRTExRTExRTExMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUVoiOiAiQyIsICJNTExRTExRTExRTExRTExRTExRTExRTExRWk1MTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFaTUxMUUxMUUxMUUxMTFFMTFFMTExRTExRTExRTExRTExRTExRTExRTExRTExRTExRWk1MTFFMTFFMTFFMTFFMTFFMTFFMTFFaIjogIkQiLCAiTUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMTFFMTFFMTFFMTFFMTFFMTExRTExRTExRTExRWk1MTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTExRTExRTExRTExMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFaIjogIkUiLCAiTUxMUUxMUUxMUUxMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTExRTExRTExRWk1MTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTExRTExRTExRTExRTExMUUxMUUxMUUxMUUxMUUxMUVoiOiAiRiIsICJNTExRTExRTExRTExMUUxMUUxMUUxMUUxMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTExRTExRTExRWk1MTFFMTFFMTFFMTFFMTExRTExRTExRTExRTExRTExRTExRTExMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTExRTExRTExRTExRTExRTExRTExRTExRTExMUUxMWiI6ICJHIiwgIk1MTExRTExRTExRTExRTExRTExRTExRTExRTExRTExRTExRTExRTExRTExRTExRWk1MTFFMTFFMTFFMTFFMTFFMTExRTExRTExRTExRTExRTExRTExRTExRTExRTExRTExRTExRTExRTExRTExRTExRTExRTExRTExRWiI6ICJIIiwgIk1MTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFaTUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUVoiOiAibCIsICJNTExMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUVpNTExMTExRTExRTExRTExRTExRTExRTExRTExRTExRTExRTExRTExRTExRTExRTExRTExRTExRWiI6ICJKIiwgIk1MTFFMTFFMTFFMTExRTExRTExRTExRTExRTExRTExMUUxMUUxMUUxMTExMUVpNTExRTExRTExRTExMUUxMUUxMTFFMTFFMTFFMTFFMTExRTExRTExRTExRTExRTExRTExRTExRTExRTExRTExRWiI6ICJLIiwgIk1MTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFaTUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUVoiOiAiTCIsICJNTExRTExMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUVpNTExRTExRTExRTExRTExRTExMUUxMUUxMUUxMUUxMUUxMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTExRTExRTExRTExRTExRWiI6ICJNIiwgIk1MTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMWk1MTFFMTExRTExRTExRTExRTExRTExRTExRTExRTExMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUVoiOiAiTiIsICJNTExRTExRTExRTExRTExRTExRTExRTExRTExRWk1MTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFaTUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUVpNTExRTExRTExRTExRTExRTExRTExRTExRWiI6ICJPIiwgIk1MTFFMTFFMTExRTExRTExRTExRWk1MTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFaTUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMTFFMTFFMTFFMTFFMTFFaTUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMTFFaIjogIlAiLCAiTUxMUUxMUUxMUUxMUUxMUUxMUUxMTFFMTFFMTFFMTExRTExMUUxMUUxMUUxMUUxMUVpNTExRTExMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUVpNTExRTExRTExRTExRTExRTExRTExRTExRTExRTExRTExRTExRTExRTExRTExRTExMTFFMTFFMTFFMTFFMTFFMTFFMTFFaTUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMTFFMTFFMTExMTFFMTFFMTFFaIjogIlEiLCAiTUxMUUxMUUxMUUxMUUxMUUxMUVpNTExRTExRTExRTExRTExRTExRTExRTExMUUxMUUxMTFFMTFFMTFFaTUxMTExRTExRTExRTExMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMTFFMTFFMTFFaTUxMUUxMTFFMTFFMTFFMTFFMTFFMTFFMTFFaIjogIlIiLCAiTUxMUUxMUUxMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFaTUxMUUxMUUxMUUxMUUxMUUxMUUxMTFFMTExMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMTExMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUVoiOiAiUyIsICJNTExRTExRTExRTExRTExMUUxMUUxMUUxMUUxMUUxMUUxMUVpNTExRTExRTExRTExRTExRTExRTExRTExRTExRTExRTExRTExRTExRTExRTExRTExRTExRTExRTExRWiI6ICJUIiwgIk1MTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTExRTExRTExRTExRWk1MTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFaIjogIlUiLCAiTUxMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFaTUxMUUxMUUxMUUxMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFaIjogIlYiLCAiTUxMUUxMUUxMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTExRTExMUUxMUUxMUUxMUUxMUUxMUUxMTFFaTUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMTFFMTExRTExRTExRTExRTExRTExRTExRTExRTExRTExRTExRTExMUUxMUUxMUUxMUUxMUUxMUUxMUVoiOiAiVyIsICJNTExRTExRTExRTExRTExRTExRTExRTExRTExRTExRTExRTExRWk1MTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTExMUUxMUUxMUUxMUUxMUUxMUUxMTFFMTFFMTFFMTFFaIjogIlgiLCAiTUxMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFaTUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMTFFMTFFMTFFMTFFMTFoiOiAiWSIsICJNTExRTExRTExRTExRTExRTExRTExRTExRTExMUUxMTFFMTFFMTFFMTExRTExRTExRTExRWk1MTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTExRWiI6ICJaIiwgIk1MTFFMTFFMTFFMTFFMTFFMTFFMTFFaTUxMUUxMTFFMTFFMTFFMTFFMTFFMTExRTExRTExRTExRTExRTExRTExRTExRWk1MTExRTExRTExRTExRTExRTExRTExMUUxMUUxMUUxMUUxMTFFMTFFMTFFMTFFMTFFMTExRTExRWk1MTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFaIjogImEiLCAiTUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUVpNTExRTExRTExRTExRTExRTExRTExRTExRTExRTExRTExRTExRTExRWk1MTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTExRWk1MTFFMTFFMTFFMTFFMTFFMTFFMTFFMTExRWiI6ICJiIiwgIk1MTExRTExRTExRTExRTExRTExRTExRTExRTExRTExRTExRTExRTExRTExMUUxMUUxMUUxMUUxMUUxMUUxMTFFMTFFMTFFaTUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTExMUUxMUUxMUVoiOiAiYyIsICJNTExRTExRTExRTExRTExRTExRTExRTExRWk1MTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFaTUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMTFFMTFFMTFFMTFFaTUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUVoiOiAiZCIsICJNTExRTExRTExRTExRTExRTExRWk1MTFFMTFFMTFFMTFFMTFFMTFFMTExRTExRTExRTExRTExRTExMUUxMUUxMUUxMUUxMUVpNTExRTExRTExRTExRTExRTExRTExRTExMUUxMUUxMUUxMUUxMTFFMTFFMTFFMTFFMTFFMTFFMTExRWk1MTFFMTFFMTFFMTFFMTFFaTUxMUUxMTExRTExRTExRWiI6ICJlIiwgIk1MTFFMTExRTExRTExRTExMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMTFFMTFFaTUxMUUxMUUxMTFFMTFFMTFFMTFFMTFFMTExRTExRTExMUUxMTExRTExRTExMUUxMUUxMUUxMUUxMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFaIjogImYiLCAiTUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUVpNTExRTExRTExRTExRTExRTExRTExRTExMUUxMUUxMUUxMUUxMUUxMUUxMUUxMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFaTUxMUUxMUUxMUUxMUUxMUUxMTFFMTExRTExRTExRTExMUUxMUUxMUUxMUUxMTExRTExRTExRTExRTExRTExMUUxMTFFMTFFMTExRTExMUVpNTExRTExRTExRTExRTExRTExRTExRTExRWiI6ICJnIiwgIk1MTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFaTUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTExRTExRTExRTExRTExRTExMUUxMUVoiOiAiaCIsICJNTExRTExMUUxMUUxMUUxMUVpNTExRTExRTExRTExRTFpNTExRTExRTExRTExRTExRTExRTExMUUxMUUxMUUxMUVpNTExMTFFMTFFMTFFMTFFMTFFMTFFMTFFaIjogImkiLCAiTUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMTFFMTFFMTFFMTFFMTFFMTFFaTUxMUUxMUUxMWk1MTFFMTFFMTFFMTFFMTFFMTFFMTFFMTExRTExRTExMUUxMUUxMUUxMUUxMUUxMTFFMTExMUUxMUVpNTExMUUxMUUxMUUxMUUxMUUxMUUxMUVoiOiAiaiIsICJNTExRTExRTExRTExRTExRTExRTExRTExRTExRTExMUUxMUUxMUUxMUVpNTExRTExRTExRTExRTExMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUVoiOiAiayIsICJNTExRTExRTExRTExRTExRTExRTExRTExRTExRTExRTExRTExRTExRTExRTExRTExRTExRTExRTExRTExRTExRTExMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUVpNTExRTExRTExRTExRTExRTExRTExRTExMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMTFFMTFFMTFFMTFFMTFFMTExRTExRTExMUUxMUUxMUUxMUUxMUUxMUUxMTFFMTFFMTFFMTFFMTExRTExRWk1MTExaIjogIm0iLCAiTUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUVpNTExRTExMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUVoiOiAibiIsICJNTExRTExRTExRTExRTExRTExRTExRWk1MTExRTExRTExRTExRTExRTExRTExRTExRTExRTExRTExRWk1MTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTExRTExRTExMUUxMUUxMUUxMUUxMUUxMUUxMTFFMTFFaTUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUVoiOiAibyIsICJNTExRTExRTExRTExRTExRTExRTExRTExRWk1MTFFMTFFMTFFMTFFMTFFMTFFMTFFMTExRTExRTExRTExMUUxMTFFMTFFMTFFMTFFMTFFaTUxMUUxMUUxMUUxMUUxMTExMUUxMTFFMTFFMTExRTExRTExRTExMUUxMUUxMUUxMUUxMUUxaTUxMUUxMUUxMUUxMUUxMTFFMTExRTExMUUxMUVoiOiAicCIsICJNTExRTExRTExRTExRTExRTExRTExRTExRTExRTExRTExRWk1MTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFaTUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMTFFMTFFMTFFaTUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUVoiOiAicSIsICJNTExRTExRTExRTExRTExRTExRTExRTExRTExMUUxMUUxMUUxMUVpNTExRTExRTExRTExRTExRTExRTExMTFFMTFFMTFFMTFFMTFFMTFFMTExRTExRTExRTExRTExaTUxMTFoiOiAiciIsICJNTExMUUxMUUxMUUxMUUxMUUxMUUxMTFFMTFFMTFFMTFFMTFFMTExRTExRTExRTExRTExRTExRTExRTExRTExRWk1MTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTExMTExRTExRTExRTExRTExRTExRTExRTExRTExRTExRTExMUUxMUUxMTExRTExRTExRTExMUUxMUVoiOiAicyIsICJNTExRTExRTExRTExRTExMUUxMUUxMUUxMTFFMTFFMTFFMTFFMTFFaTUxMUUxMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTExMUUxMUUxMUUxMUUxMUUxMUUxMUUxMTFFMTExRTExRTExRWiI6ICJ0IiwgIk1MTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTExRTExRTExRTExRTExRTExMUUxMUUxMUVpNTExRTExRTExRTExRTExRTExRTExRTExMUUxMUUxMUUxMTExMUUxMUUxMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFaIjogInUiLCAiTUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUVpNTExRTExMUUxMUUxMUUxMUUxMUUxMUUxMTFFMTFFMTFFMTFFMTExRTExMUVoiOiAidiIsICJNTExRTExMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMTFFMTFFMTFFMTFFMTFFMTExRWk1MTFFMTFFMTFFMTFFMTFFMTExRTExRTExRTExRTExMUUxMTFFMTFFMTFFMTExRTExRTExRTExRTExRTExRTExMUUxMUUxMUUxMUUxMWiI6ICJ3IiwgIk1MTFFMTFFMTFFMTExRTExRTExRTExRTExRTExRTExRTExRTExRWk1MTFFMTFFMTFFMTExRTExRTExRTExRTExRTExRTExRTExRTExRTExRTExRTExMUUxMUUxMUUxMUUxMUUxMTFFaIjogIngiLCAiTUxMUUxMUUxMUUxMUUxMUUxMUUxMUUxMTFFMTFFaTUxMUUxMTFFMTFFMTExRTExRTExRTExRTExRTExRTExRTExRTExRTExRTExRTExMUUxMUVoiOiAieSIsICJNTExRTExRTExRTExRTExRTExRTExRTExMUUxMUUxMUUxMUUxMUUxMUVpNTExRTExRTExRTExRTExRTExRTExRTExRTExRTExRTExRTExMUUxMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFMTFFaIjogInoifQ=="

var parsed_model = JSON.parse(atob(model))
var parser = new DOMParser();

let mobilenumber = window.localStorage.getItem("mobile");
let state_name = window.localStorage.getItem("state");
let district_name = window.localStorage.getItem("district");
let first_5_pin_digits = window.localStorage.getItem("pincode");
let allow_multiple = window.localStorage.getItem("allow_multiple") === "true" ? true : false;
let ageSelectorText = window.localStorage.getItem("age");
let searchByDistrictFlag = window.localStorage.getItem("searchpref") === "district" ? true : false;
let keeptryingcontinuously = window.localStorage.getItem("keeptryingcontinuously") === "true" ? true : false;
let timeslotind = window.localStorage.getItem("timeslot");


function setWorkerInterval(id, callbackFunction, interval) {
    var worker = new Worker(chrome.runtime.getURL("intervalWorker.js"));
    worker.postMessage({ "workerId": id, "interval": interval });
    worker.onmessage = function(event) {
        callbackFunction();
    };
}

setWorkerInterval('searchSlot', searchSlot, 10000);

function searchSlot() {
    console.log("searchSlot called");
    $('.pin-search-btn').trigger('click');
}
var waitForEl = function(selector, callback) {
    if ($(selector).length) {
        callback();

    } else {
        setTimeout(function() {
            waitForEl(selector, callback);
        }, 100);
    }
};

var waitForElAgain = function(selector, callback) {
    if ($(selector).length) {
        callback();
        waitForElAgain(selector, callback);
    } else {
        setTimeout(function() {
            waitForEl(selector, callback);
        }, 100);
    }
};

const repFun = () => {
    waitForEl("[formcontrolname=mobile_number]", function() {
        $("[formcontrolname=mobile_number]").on('input', (e) => {
            if (e.target.value.length === 10) {
                $('.login-btn').trigger('click');
            }
        });
        $("[formcontrolname=mobile_number]").val(mobilenumber);
        $("[formcontrolname=mobile_number]")[0].dispatchEvent(new Event("input", {
            bubbles: true
        }));

    });

    waitForEl("[formcontrolname=otp]", function() {
        $("[formcontrolname=otp]").on('input', (e) => {
            if (e.target.value.length === 6) {
                $('.vac-btn').trigger('click');
            }
        })
    });

    // waitForEl(".register-btn", () => {
    //   console.log("clicking button");
    //   if(!!!allow_multiple) $('.register-btn').trigger('click');
    // })

    const dispatchStateDistrictClick = () => {
        // checked = district
        // unchecked = pincode
        setTimeout(() => {
            if (searchByDistrictFlag) {
                if ($("[formcontrolname=searchType]")[0] && !!!$("[formcontrolname=searchType]")[0].checked)
                    searchSlot();
            } else {
                $("[formcontrolname=pincode]").val(first_5_pin_digits);
                $("input[formcontrolname='pincode']")[0].dispatchEvent(new Event("input", {
                    bubbles: true
                }));
            }
        }, 500);
    }

    waitForEl("[formcontrolname=searchType]", function() {

        dispatchStateDistrictClick();
        $("[formcontrolname=pincode]").on('input', (e) => {
            if (e.target.value.length === 6) {
                searchSlot();
            }
        })

        $("[formcontrolname=searchType]").on('change', () => {
            let searchByDistrict = $("[formcontrolname=searchType]")[0].checked;
            if (searchByDistrict && state_name.trim() !== "" && district_name.trim() !== "") {
                $("[formcontrolname=state_id]").trigger('click');
                $(`span:contains(${state_name})`).trigger('click');
                setTimeout(() => {
                    $("[formcontrolname=district_id]").trigger('click');
                    $(`span:contains(${district_name})`).trigger('click');
                    setTimeout(() => {
                        searchSlot();
                    }, 500);
                }, 500);
            } else {
                $("[formcontrolname=pincode]").val(first_5_pin_digits);
                $("input[formcontrolname='pincode']")[0].dispatchEvent(new Event("input", {
                    bubbles: true
                }));
            }

        });
    });
}

function enterCaptcha() {

    let timeslots = $('.time-slot');
    let slotind = 1;
    if (timeslots.length === 0) return;
    if (timeslots.length === 4) {
        console.log(timeslots);
        try {
            slotind = parseInt(timeslotind) - 1;
            console.log(slotind);
        } catch (e) {
            slotind = 1;
        }
    }
    timeslots[slotind].click();

    var svg = parser.parseFromString(atob($("img#captchaImage").attr("src").split("base64,")[1]), "image/svg+xml");
    $(svg).find('path').each((_, p) => { if ($(p).attr('stroke') != undefined) $(p).remove() })
    vals = []
    $(svg).find('path').each(
        (_, p) => {
            idx = parseInt($(p).attr("d").split(".")[0].replace("M", ""))
            vals.push(idx)
        }
    )
    var sorted = [...vals].sort(function(a, b) { return a - b; })
    var solution = ['', '', '', '', '']

    $(svg).find('path').each(
        (idx, p) => {
            var pattern = $(p).attr('d').replace(/[\d\.\s]/g, "")

            solution[sorted.indexOf(vals[idx])] = parsed_model[pattern]
        })

    $($(".captcha-style input")[0]).focus();
    console.log(solution);

    for (var ii = 0; ii < 5; ii++) {
        $($(".captcha-style input")[0]).val(solution.join("").substr(0, ii + 1));

        $(".captcha-style input")[0].dispatchEvent(new Event("keyup", { bubbles: true }));

    }

    setTimeout(() => {
        $("ion-button.confirm-btn")[0].click();
        console.log("Waiting for clicking Confirm Button!");
    }, 500);

}

$(document).on('click', '.pin-search-btn', function() {
    console.log("Search Slot Called");
    setTimeout(() => {
        $(`label:contains(${ageSelectorText})`).trigger('click');
        setTimeout(() => {
            var availableSlots = $(".slot-available-wrap > li > div.slots-box").not('.no-seat').not('.no-available').not('.less-seat');
            if (availableSlots.length > 0) {
                showNotification(slotAvailabilityNotification);
                waitForEl("ion-button.confirm-btn", function() {
                    setTimeout(enterCaptcha, 1000);
                });
                if (keeptryingcontinuously) {
                    $(availableSlots[0]).click();
                }
            }
        }, 500);
    }, 500);
});

function slotAvailabilityNotification() {
    new Notification('Slot found. Trying to redirect to Booking page', {
        body: `Slot fount at ${new Date()}. Trying to redirect user to first available slot`,
        renotify: true,
        tag: "SlotAvailability"
    });
}

$(window).on("load", () => {
    console.log("loaded");
    repFun();
});

let focus_ids = ["[formcontrolname=otp]", "[formcontrolname=mobile_number]", "[formcontrolname=pincode]"];

if (window.location.hash) {
    $(window).trigger('hashchange')
}
const parseJwt = (token) => {
    try {
        return JSON.parse(atob(token.split('.')[1]));
    } catch (e) {
        return null;
    }
};

const get_mins = (tm) => {
    let mins = Math.floor(tm / 60);
    let secs = Math.floor(tm - mins * 60);
    return `${mins}:${secs}`
}

const expirationUpdate = () => {
    let token = window.sessionStorage["userToken"];
    if (token === undefined) {
        return;
    }
    let parsed = parseJwt(token);
    if (!!!parsed) {
        return;
    }
    let exp = parsed.exp;
    let curr = new Date();
    let expd = new Date(0);
    expd.setUTCSeconds(exp);
    if (expd - curr <= 0) {
        if ($('.logout-text li').length > 0) {
            showNotification(logoutNotification);
            console.log("User Token Expired. Clicking Logout button");
            $('.logout-text li').click();
        }
    } else {
        document.title = get_mins((expd - curr) / 1000);
    }
}

function showNotification(notificationMethod) {
    if (Notification.permission === "granted") {
        notificationMethod();
    } else if (Notification.permission !== "denied") {
        Notification.requestPermission(function(status) {
            // If the user said okay
            if (status === "granted") {
                notificationMethod();
            }
        });
    }
}

function logoutNotification() {
    var notification = new Notification('User Token Expired, user logged out', {
        body: `User Session expired at ${new Date()}`,
        renotify: true,
        tag: "LogoutNotification"
    });
    notification.onclick = function(event) {
        parent.focus();
        window.focus();
    }
}

//setInterval(expirationUpdate, 5000);
setWorkerInterval('expirationUpdate', expirationUpdate, 5000)

var current_href = location.href;
setInterval(function() {
    if (current_href !== location.href) {
        repFun();
        current_href = location.href;
    } else {}
}, 100);


const keep_focusing = () => {

    setInterval(() => {
        focus_ids.forEach(element => {

            if ($("#formWrapper").is(":hidden"))
                if ($(element).length !== 0) $(element).focus();
        });

    }, 1000);
}


keep_focusing();

const createInput = (id, style, type, value) => {
    let retel = document.createElement("input");
    retel.id = id;
    retel.type = type;
    retel.style = style;
    retel.value = value;
    return retel;
}

const createLabel = (id, forid, labelText, style) => {
    let retel = document.createElement("label");
    retel.id = id;
    retel.for = forid;
    retel.appendChild(document.createTextNode(labelText));
    retel.style = style;
    return retel;
}

const createWarningText = (warningtext, style) => {
    let retel = document.createElement('p');
    retel.appendChild(document.createTextNode(warningtext));
    retel.style = style;
    return retel;
}

const createSelectInput = (id, style, value) => {
    let retel = document.createElement("select");
    retel.style = style;
    retel.id = id;
    retel.value = value;
    return retel;
}

const createSelectOptions = (id, text, value, selected) => {
    let retel = document.createElement("option");
    retel.id = id;
    retel.value = value;
    retel.appendChild(document.createTextNode(text));
    if (selected) retel.selected = true;
    return retel;
}

const createHrSeparator = () => {
    let retel = document.createElement("hr");
    retel.style = "background-color: black";
    return retel;
}
const createForm = () => {

    // basic styles : reused
    let textLabelStyles = "color: black; padding-left: 1%;";
    let inputStyles = "color: black; background: white;";
    let warnLabelStyles = "color: red; padding-left: 1%;";

    // parent div for form
    let wrapperDiv = document.createElement("div");
    wrapperDiv.id = "formWrapper";
    wrapperDiv.style = "position: fixed; background: white; top: 12.5%; width: 75%; left: 12.5%; border: 3px solid #73AD21; overflow:scroll; height: 80%"

    // mobile number input field
    let mobileinputid = "data-mob";
    let mobileInput = createInput(mobileinputid, inputStyles, "number", mobilenumber);
    let mobileLabel = createLabel("mobileinputlabel", mobileinputid, "Mobile number (first 9 digits): ", textLabelStyles);
    let mobileNumberWarn = createWarningText(
        "You will have to enter the 10th digit in the actual website form to proceed with automation.",
        warnLabelStyles
    )

    // pin code field
    let pincodeinputid = "pincodeinput";
    let pincodeinput = createInput(pincodeinputid, inputStyles, "number", first_5_pin_digits);
    let pincodelabel = createLabel("pincodeinputlabel", pincodeinputid, "PIN Code (First 5 digits): ", textLabelStyles);
    let pincodewarn = createWarningText("You will have to enter the 6th digit in the actual website form manually to proceed with automation.", warnLabelStyles);

    // state name input field
    let stateinputid = "data-state";
    let stateInput = createInput(stateinputid, inputStyles, "text", state_name);
    let stateLabel = createLabel("stateinputlabel", stateinputid, "Name of the state: ", textLabelStyles)

    // district name input field
    let districtinputid = "data-district";
    let districInput = createInput(districtinputid, inputStyles, "text", district_name);
    let districLabel = createLabel("districtinputlabel", districtinputid, "District name: ", textLabelStyles);

    let ageSelector = createSelectInput("ageselect", inputStyles, ageSelectorText);
    let age18 = createSelectOptions("age18", "Age 18+", "Age 18+", ageSelectorText === "Age 18+");
    let age45 = createSelectOptions("age45", "Age 45+", "Age 45+", ageSelectorText === "Age 45+");
    ageSelector.appendChild(age18);
    ageSelector.appendChild(age45);
    let AgeSelectLabel = createLabel("ageselectlabel", "ageselect", "Age group: ", textLabelStyles)


    // multiple members allow checkbox
    // let allowMultipleid = "allowMultiple";
    // let allowMultipleInput = createInput(allowMultipleid, inputStyles, "checkbox", "");
    // allowMultipleInput.checked = allow_multiple;
    // let allowMultipleInputLabel = createLabel("multipleinputlabel", allowMultipleid, "Allow multiple members ", textLabelStyles);
    // let allowMultipleWarn = createWarningText("This will prevent automatic click on the Schedule Now button", warnLabelStyles);

    let continuousretryid = "continuousretry";
    let continuousretryinput = createInput(continuousretryid, inputStyles, "checkbox", "");
    continuousretryinput.checked = keeptryingcontinuously;
    let continuousretrylabel = createLabel("continuousretrylabel", continuousretryid, "Select available slot randomly", textLabelStyles);
    let continuousretryWarn = createWarningText("This will keep looking for available slots on screen continously and automatically attempt to book a slot randomly, please check appointment details on the captcha page. FIRST AVAILABLE SLOT ON THE PAGE WILL BE SELECTED. ", warnLabelStyles);


    let timeslotinputid = "timeslotinput";
    let timeslotinput = createInput(timeslotinputid, inputStyles, "number", timeslotind);
    let timeslotlabel = createLabel("timeslotinputlabel", timeslotinputid, "Enter time slot preference: ", textLabelStyles);
    let timeslotwarn = createWarningText("There are 4 time slots available in general. Select one of these (1) 9-11 (2) 11-1 (3) 1-3 (4) 3-5. If these are not the cases available there, slot number two will be selected automatically. You can change this slot manually on the captcha screen.", warnLabelStyles);
    timeslotinput.min = 1;
    timeslotinput.max = 4;

    // search preferrance
    let searchprefid = "searchpref";
    let searchPrefSelector = createSelectInput(searchprefid, inputStyles, searchByDistrictFlag ? "district" : "pincode");
    let districtoption = createSelectOptions("districtoption", "District", "district", searchByDistrictFlag);
    let pincodeoption = createSelectOptions("pincodeoption", "PIN code", "pincode", !!!searchByDistrictFlag);
    searchPrefSelector.appendChild(districtoption);
    searchPrefSelector.appendChild(pincodeoption);
    let searchPrefLabel = createLabel("searchpreflabel", searchprefid, "Search by: ", textLabelStyles);

    // submit button
    let submitButton = document.createElement("button");
    submitButton.appendChild(document.createTextNode("Save inputs"));
    submitButton.id = "data-submit";
    submitButton.style = "color: black; background: #c2d6d6; font-size:20px; border-radius: 10px;"

    // cancel button
    let cancelbutton = document.createElement("button");
    cancelbutton.id = "cancelbutton";
    cancelbutton.appendChild(document.createTextNode("Cancel"));
    cancelbutton.style = "color: white; background: black; font-size:20px; border-radius: 10px;";

    // add components to wrapper div
    wrapperDiv.appendChild(mobileLabel);
    wrapperDiv.appendChild(mobileInput);
    wrapperDiv.appendChild(mobileNumberWarn);
    wrapperDiv.appendChild(createHrSeparator());
    wrapperDiv.appendChild(pincodelabel);
    wrapperDiv.appendChild(pincodeinput);
    wrapperDiv.appendChild(pincodewarn);
    wrapperDiv.appendChild(createHrSeparator());

    wrapperDiv.appendChild(stateLabel);
    wrapperDiv.appendChild(stateInput);
    wrapperDiv.appendChild(createHrSeparator());
    wrapperDiv.appendChild(districLabel);
    wrapperDiv.appendChild(districInput);
    wrapperDiv.appendChild(createHrSeparator());
    wrapperDiv.appendChild(AgeSelectLabel);
    wrapperDiv.appendChild(ageSelector);
    wrapperDiv.appendChild(createHrSeparator());

    // wrapperDiv.appendChild(allowMultipleInputLabel);
    // wrapperDiv.appendChild(allowMultipleInput);
    // wrapperDiv.appendChild(document.createElement('br'));
    // wrapperDiv.appendChild(allowMultipleWarn);
    // wrapperDiv.appendChild(createHrSeparator());
    wrapperDiv.appendChild(continuousretrylabel);
    wrapperDiv.appendChild(continuousretryinput);
    wrapperDiv.appendChild(continuousretryWarn);
    wrapperDiv.appendChild(createHrSeparator());
    wrapperDiv.appendChild(timeslotlabel);
    wrapperDiv.appendChild(timeslotinput);
    wrapperDiv.appendChild(timeslotwarn);
    wrapperDiv.appendChild(createHrSeparator());
    wrapperDiv.appendChild(searchPrefLabel);
    wrapperDiv.appendChild(searchPrefSelector);
    wrapperDiv.appendChild(createHrSeparator());
    wrapperDiv.appendChild(submitButton);
    wrapperDiv.appendChild(cancelbutton)

    // add form
    document.body.appendChild(wrapperDiv);
}

const createHideShowButton = () => {
    $("#formWrapper").hide();
    let formShowHide = document.createElement("button");
    formShowHide.id = "formshowhidebutton";
    formShowHide.appendChild(document.createTextNode("click to edit the autofill inputs"));
    formShowHide.style = "background: red; position: sticky; top:0; left: 0; font-size: 32px; border-radius: 20px;";
    document.body.appendChild(formShowHide);
    $('#formshowhidebutton').on('click', () => {
        $("#formWrapper").toggle();
    })
}

const bindSubmitButtonToSaveInfo = () => {
    let submitbtn = document.getElementById("data-submit");
    let cancelbutton = document.getElementById("cancelbutton");
    cancelbutton.addEventListener("click", () => {
        $("#formWrapper").toggle();
    });
    submitbtn.addEventListener("click", () => {
        mobilenumber = document.getElementById("data-mob").value;
        state_name = document.getElementById("data-state").value;
        district_name = document.getElementById("data-district").value;
        // allow_multiple = document.getElementById("allowMultiple").checked;
        keeptryingcontinuously = document.getElementById("continuousretry").checked;
        ageSelectorText = document.getElementById("ageselect").value;
        let searchPreftext = document.getElementById("searchpref").value;
        first_5_pin_digits = document.getElementById("pincodeinput").value;
        timeslotind = document.getElementById("timeslotinput").value;
        console.log(allow_multiple);
        $("#formWrapper").hide();
        window.localStorage.setItem("mobile", mobilenumber);
        window.localStorage.setItem("state", state_name);
        window.localStorage.setItem("district", district_name);
        // window.localStorage.setItem("allow_multiple", allow_multiple);
        window.localStorage.setItem("keeptryingcontinuously", keeptryingcontinuously);

        window.localStorage.setItem("age", ageSelectorText);
        window.localStorage.setItem("searchpref", searchPreftext);
        window.localStorage.setItem("pincode", first_5_pin_digits);
        window.localStorage.setItem("timeslot", timeslotind);
        window.location.reload();
    })
}

const createFormAndOthers = () => {
    createForm();
    createHideShowButton();
    bindSubmitButtonToSaveInfo();
}

createFormAndOthers();